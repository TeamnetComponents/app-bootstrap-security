<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="current_timestamp" dbms="postgresql"/>
    <property name="now" value="sysdate" dbms="oracle"/>
    <property name="activated" value="true" dbms="postgresql"/>
    <property name="activated" value="1" dbms="oracle"/>

    <property name="pk_t_module" value="HIBERNATE_SEQUENCE.NEXTVAL" dbms="oracle"/>
    <property name="pk_t_module" value="nextval('t_module_id_module_seq')" dbms="postgresql"/>
    <property name="pk_t_module" value="null" dbms="!oracle,!postgresql"/>

    <!-- Create ID_ACCOUNT table -->
    <changeSet id="20150212" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_ACCOUNT">
            <column name="ID_ACCOUNT" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="LOGIN" type="varchar(50)">
                <constraints unique="true"/>
            </column>
            <column name="PASSWORD" type="varchar(100)"/>
            <column name="FIRST_NAME" type="varchar(50)"/>
            <column name="LAST_NAME" type="varchar(50)"/>
            <column name="EMAIL" type="varchar(100)">
                <constraints unique="true"/>
            </column>
            <column name="IS_ACTIVE" type="boolean" defaultValueBoolean="true" valueBoolean="true">
                <constraints nullable="false"/>
            </column>
            <column name="LANG_KEY" type="varchar(5)"/>
            <column name="ACTIVATION_KEY" type="varchar(20)"/>
            <column name="CREATED_BY" type="varchar(50)" defaultValue="system">
                <constraints nullable="false"/>
            </column>
            <column name="CREATED_DATE" type="timestamp" defaultValueDate="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_MODIFIED_BY" type="varchar(50)"/>
            <column name="LAST_MODIFIED_DATE" type="timestamp"/>
            <column name="GENDER" type="varchar(20)"/>
            <column name="FK_USER_PROFILE" type="varchar(50)"/>
        </createTable>
    </changeSet>


    <!-- Create T_ROLE table -->
    <changeSet id="20150212#2" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_ROLE">
            <column name="ID_ROLE" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="VERSION" type="bigint"/>
            <column name="CODE" type="varchar(100)">
                <constraints unique="true"/>
            </column>
            <column name="DESCRIPTION" type="varchar(255)"/>
            <column name="SORT" type="NUMBER(10,0)"/>
            <column name="VALID_FROM" type="TIMESTAMP"/>
            <column name="VALID_TO" type="TIMESTAMP"/>
            <column name="IS_ACTIVE" type="boolean" defaultValueBoolean="true" valueBoolean="true">
                <constraints nullable="false"/>
            </column>
            <column name="LOCAL" type="int"/>
            <column name="CREATED_BY" type="varchar(50)" defaultValue="system">
                <constraints nullable="false"/>
            </column>
            <column name="CREATED_DATE" type="timestamp" defaultValueDate="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_MODIFIED_BY" type="varchar(50)"/>
            <column name="LAST_MODIFIED_DATE" type="timestamp"/>
        </createTable>
    </changeSet>

    <!-- Create T_ACCOUNT_ROLES table -->
    <changeSet id="20150212#3" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_ACCOUNT_ROLES">
            <column name="FK_ACCOUNT" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="FK_ROLE" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addPrimaryKey columnNames="FK_ACCOUNT, FK_ROLE" tableName="T_ACCOUNT_ROLES"/>

        <addForeignKeyConstraint baseColumnNames="FK_ACCOUNT"
                                 baseTableName="T_ACCOUNT_ROLES"
                                 constraintName="FK_ACCOUNT_ROLE_ACC"
                                 referencedColumnNames="ID_ACCOUNT"
                                 referencedTableName="T_ACCOUNT"/>

        <addForeignKeyConstraint baseColumnNames="FK_ROLE"
                                 baseTableName="T_ACCOUNT_ROLES"
                                 constraintName="FK_ACCOUNT_ROLE_ROLE"
                                 referencedColumnNames="ID_ROLE"
                                 referencedTableName="T_ROLE"/>
    </changeSet>

    <!-- Create T_MODULE table -->
    <changeSet id="20150212#7" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_MODULE">
            <column name="ID_MODULE" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="VERSION" type="bigint"/>
            <column name="CODE" type="varchar(100)"/>
            <column name="TYPE" type="NUMBER(5,0)"/>
            <column name="DESCRIPTION" type="varchar(255)"/>
            <column name="FK_PARENT_MODULE" type="bigint">
                <constraints foreignKeyName="fk_parent_module"
                             referencedColumnNames="ID_MODULE"
                             referencedTableName="T_MODULE"/>
            </column>
        </createTable>
    </changeSet>

    <!--Create T_MODULE_RIGHT table -->
    <changeSet id="20150212#4" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="VERSION" type="bigint"/>
            <column name="MODULE_RIGHT" type="NUMBER(5,0)"/>
            <column name="FK_MODULE" type="bigint">
                <constraints foreignKeyName="fk_module_right_module"
                             referencedColumnNames="ID_MODULE"
                             referencedTableName="T_MODULE"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create T_ACCOUNT_MODULE_RIGHTS table -->
    <changeSet id="20150212#5" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_ACCOUNT_MODULE_RIGHTS">
            <column name="FK_ACCOUNT" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="FK_MODULE_RIGHT" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addPrimaryKey columnNames="FK_ACCOUNT, FK_MODULE_RIGHT" tableName="T_ACCOUNT_MODULE_RIGHTS"/>

        <addForeignKeyConstraint baseColumnNames="FK_ACCOUNT"
                                 baseTableName="T_ACCOUNT_MODULE_RIGHTS"
                                 constraintName="FK_ACCOUNT_RIGHT_ACC"
                                 referencedColumnNames="ID_ACCOUNT"
                                 referencedTableName="T_ACCOUNT"/>

        <addForeignKeyConstraint baseColumnNames="FK_MODULE_RIGHT"
                                 baseTableName="T_ACCOUNT_MODULE_RIGHTS"
                                 constraintName="FK_ACCOUNT_RIGHT_MODULE"
                                 referencedColumnNames="ID_MODULE_RIGHT"
                                 referencedTableName="T_MODULE_RIGHT"/>
    </changeSet>

    <!--Create T_ROLE_MODULE_RIGHTS table -->
    <changeSet id="20150212#6" author="security-bootstrap" failOnError="true">
        <createTable tableName="T_ROLE_MODULE_RIGHTS">
            <column name="FK_ROLE" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="FK_MODULE_RIGHT" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addPrimaryKey columnNames="FK_ROLE, FK_MODULE_RIGHT" tableName="T_ROLE_MODULE_RIGHTS"/>

        <addForeignKeyConstraint baseColumnNames="FK_MODULE_RIGHT"
                                 baseTableName="T_ROLE_MODULE_RIGHTS"
                                 constraintName="FK_ROLE_PERM_PERM"
                                 referencedColumnNames="ID_MODULE_RIGHT"
                                 referencedTableName="T_MODULE_RIGHT"/>

        <addForeignKeyConstraint baseColumnNames="FK_ROLE"
                                 baseTableName="T_ROLE_MODULE_RIGHTS"
                                 constraintName="FK_ROLE_PERM_ROLE"
                                 referencedColumnNames="ID_ROLE"
                                 referencedTableName="T_ROLE"/>
    </changeSet>

     <changeSet id="20150224" author="adriand">
         <createTable tableName="T_PERSISTENT_TOKEN">
             <column name="series" type="varchar(255)">
                 <constraints primaryKey="true" nullable="false"/>
             </column>
             <column name="token_value" type="varchar(255)">
                 <constraints nullable="false" />
             </column>
             <column name="token_date" type="date"/>
             <column name="ip_address" type="varchar(39)"/>
             <column name="user_agent" type="varchar(255)"/>
             <column name="account_id_account" type="bigint"/>
         </createTable>

         <addForeignKeyConstraint baseColumnNames="account_id_account"
                                  baseTableName="T_PERSISTENT_TOKEN"
                                  constraintName="fk_user_persistent_token"
                                  referencedColumnNames="ID_ACCOUNT"
                                  referencedTableName="T_ACCOUNT"/>

    </changeSet>

    <changeSet id="20150224#4" author="adriand">
        <createTable tableName="T_LOCAL_CENTER">
            <column name="ID_LOCAL_CENTER" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="CODE" type="varchar(255)"/>
            <column name="NAME" type="varchar(255)"/>
            <column name="ADDRESS" type="varchar(255)"/>
            <column name="PHONE" type="varchar(255)"/>
            <column name="EMAIL" type="varchar(255)"/>
            <column name="TYPE" type="varchar(255)"/>
            <column name="FK_LOCAL_CENTER" type="bigint">
                <constraints foreignKeyName="fk_parent_local_center"
                             referencedColumnNames="ID_LOCAL_CENTER"
                             referencedTableName="T_LOCAL_CENTER"/>
            </column>
            <column name="IS_ACTIVE" type="boolean" defaultValueBoolean="false" valueBoolean="false">
                <constraints nullable="false"/>
            </column>

        </createTable>
    </changeSet>

    <changeSet id="20150224#2" author="adriand">
        <createTable tableName="T_EAGLE_USER">
            <column name="ID_ACCOUNT" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="LOGIN" type="varchar(50)">
                <constraints unique="true"/>
            </column>
            <column name="PASSWORD" type="varchar(100)"/>
            <column name="FIRST_NAME" type="varchar(50)"/>
            <column name="LAST_NAME" type="varchar(50)"/>
            <column name="EMAIL" type="varchar(100)">
                <constraints unique="true"/>
            </column>
            <column name="IS_ACTIVE" type="boolean" defaultValueBoolean="false" valueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="LANG_KEY" type="varchar(5)"/>
            <column name="ACTIVATION_KEY" type="varchar(20)"/>
            <column name="CREATED_BY" type="varchar(50)" defaultValue="system">
                <constraints nullable="false"/>
            </column>
            <column name="CREATED_DATE" type="timestamp" defaultValueDate="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_MODIFIED_BY" type="varchar(50)"/>
            <column name="LAST_MODIFIED_DATE" type="timestamp"/>
            <column name="GENDER" type="varchar(20)"/>
            <column name="FK_USER_PROFILE" type="varchar(50)"/>
            <column name="FK_LOCAL_CENTER" type="bigint">
                <constraints foreignKeyName="fk_eagle_user_local_center"
                             referencedColumnNames="ID_LOCAL_CENTER"
                             referencedTableName="T_LOCAL_CENTER"/>
            </column>

        </createTable>
    </changeSet>

    <changeSet id="20150224#3" author="adriand">
        <createTable tableName="T_EMPLOYEE">
            <column name="EMPOYEE_ID" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="FIRST_NAME" type="varchar(50)"/>
            <column name="LAST_NAME" type="varchar(50)"/>
            <column name="CNP" type="bigint"/>
            <column name="EMAIL" type="varchar(100)">
                <constraints unique="true"/>
            </column>
            <column name="IS_ACTIVE" type="int"/>
            <column name="TYPE" type="varchar(255)"/>
        </createTable>
    </changeSet>

    <!-- Insert Accounts -->
    <changeSet id="20150212#8" author="security-bootstrap" failOnError="true">
        <insert tableName="T_ACCOUNT">
            <column name="id_account" value="1"/>
            <column name="login" value="system"/>
            <column name="password" value="$2a$10$mE.qmcV0mFU5NcKh73TZx.z4ueI/.bDWbj0T1BYyqP481kGGarKLG"/>
            <column name="first_name" value="System"/>
            <column name="last_name" value="System"/>
            <column name="email" value="system@email.com"/>
            <column name="is_active" value="${activated}"/>
            <column name="lang_key" value="en"/>
            <column name="created_by" value="system"/>
        </insert>
        <insert tableName="T_ACCOUNT">
            <column name="id_account" value="2"/>
            <column name="login" value="admin"/>
            <column name="password" value="$2a$10$gSAhZrxMllrbgj/kkK9UceBPpChGWJA7SYIb1Mqo.n5aNLq1/oRrC"/>
            <column name="first_name" value="Admin"/>
            <column name="last_name" value="Admin"/>
            <column name="email" value="admin@email.com"/>
            <column name="is_active" value="${activated}"/>
            <column name="lang_key" value="en"/>
            <column name="created_by" value="system"/>
        </insert>
        <insert tableName="T_ACCOUNT">
            <column name="id_account" value="3"/>
            <column name="login" value="user"/>
            <column name="password" value="$2a$10$VEjxo0jq2YG9Rbk2HmX9S.k1uZBGYUHdUcid3g/vfiEl7lwWgOH/K"/>
            <column name="first_name" value="User"/>
            <column name="last_name" value="User"/>
            <column name="email" value="user@email.com"/>
            <column name="is_active" value="${activated}"/>
            <column name="lang_key" value="en"/>
            <column name="created_by" value="system"/>
        </insert>
    </changeSet>

    <!-- Insert Roles -->
    <changeSet id="20150213#1" author="security-bootstrap" failOnError="true">
        <insert tableName="T_ROLE">
            <column name="id_role" value="1"/>
            <column name="version" value="1"/>
            <column name="code" value="ROLE_SYSTEM"/>
            <column name="description" value="System Role"/>
            <column name="valid_from" value="2012-12-12T12:03:42.568"/>
            <column name="valid_to" value="2050-12-12T12:03:42.568"/>
            <column name="is_active" value="${activated}"/>
        </insert>
        <insert tableName="T_ROLE">
            <column name="id_role" value="2"/>
            <column name="version" value="1"/>
            <column name="code" value="ROLE_ADMIN"/>
            <column name="description" value="Admin role"/>
            <column name="valid_from" value="2012-12-12T12:03:42.568"/>
            <column name="valid_to" value="2050-12-12T12:03:42.568"/>
            <column name="is_active" value="${activated}"/>
        </insert>
        <insert tableName="T_ROLE">
            <column name="id_role" value="3"/>
            <column name="version" value="1"/>
            <column name="code" value="ROLE_USER"/>
            <column name="description" value="user role"/>
            <column name="valid_from" value="2012-12-12T12:03:42.568"/>
            <column name="valid_to" value="2050-12-12T12:03:42.568"/>
            <column name="is_active" value="${activated}"/>
        </insert>
    </changeSet>

    <!-- Insert id accounts and roles -->
    <changeSet id="20150213#2" author="security-bootstrap" failOnError="true">
        <insert tableName="T_ACCOUNT_ROLES">
            <column name="fk_account" value="1"/>
            <column name="fk_role" value="1"/>
        </insert>
        <insert tableName="T_ACCOUNT_ROLES">
            <column name="fk_account" value="1"/>
            <column name="fk_role" value="2"/>
        </insert>
        <insert tableName="T_ACCOUNT_ROLES">
            <column name="fk_account" value="1"/>
            <column name="fk_role" value="3"/>
        </insert>

        <insert tableName="T_ACCOUNT_ROLES">
            <column name="fk_account" value="2"/>
            <column name="fk_role" value="2"/>
        </insert>
        <insert tableName="T_ACCOUNT_ROLES">
            <column name="fk_account" value="2"/>
            <column name="fk_role" value="3"/>
        </insert>

        <insert tableName="T_ACCOUNT_ROLES">
            <column name="fk_account" value="3"/>
            <column name="fk_role" value="3"/>
        </insert>
    </changeSet>

    <!-- Insert Module -->
    <changeSet id="20150213#3" author="security-bootstrap" failOnError="true">
        <insert tableName="T_MODULE">
            <column name="ID_MODULE" valueComputed="${pk_t_module}"/>
            <column name="VERSION" value="1"/>
            <column name="CODE" value="Menu"/>
            <column name="TYPE" value="1"/>
            <column name="DESCRIPTION" value="Menu entry"/>
        </insert>
        <insert tableName="T_MODULE">
            <column name="ID_MODULE" valueComputed="${pk_t_module}"/>
            <column name="VERSION" value="1"/>
            <column name="CODE" value="Account"/>
            <column name="TYPE" value="2"/>
            <column name="DESCRIPTION" value="Account acces"/>
        </insert>
        <insert tableName="T_MODULE">
            <column name="ID_MODULE" valueComputed="${pk_t_module}"/>
            <column name="VERSION" value="1"/>
            <column name="CODE" value="Module"/>
            <column name="TYPE" value="2"/>
            <column name="DESCRIPTION" value="Module acces"/>
        </insert>
        <insert tableName="T_MODULE">
            <column name="ID_MODULE" valueComputed="${pk_t_module}"/>
            <column name="VERSION" value="1"/>
            <column name="CODE" value="ModuleRight"/>
            <column name="TYPE" value="2"/>
            <column name="DESCRIPTION" value="Entity acces"/>
        </insert>

    </changeSet>

    <!-- Insert Module Rights -->
    <changeSet id="20150213#4" author="security-bootstrap" failOnError="true">
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="1"/>
            <column name="MODULE_RIGHT" value="1"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="2"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="2"/>
            <column name="MODULE_RIGHT" value="2"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="2"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="3"/>
            <column name="MODULE_RIGHT" value="4"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="2"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="4"/>
            <column name="MODULE_RIGHT" value="8"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="2"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="5"/>
            <column name="MODULE_RIGHT" value="0"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="2"/>
        </insert>
    </changeSet>

    <!-- Insert Module Rights -->
    <changeSet id="20150213#4_2" author="security-bootstrap" failOnError="true">
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="6"/>
            <column name="MODULE_RIGHT" value="1"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="1"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="7"/>
            <column name="MODULE_RIGHT" value="2"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="1"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="8"/>
            <column name="MODULE_RIGHT" value="4"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="1"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="9"/>
            <column name="MODULE_RIGHT" value="8"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="1"/>
        </insert>
        <insert tableName="T_MODULE_RIGHT">
            <column name="ID_MODULE_RIGHT" value="10"/>
            <column name="MODULE_RIGHT" value="0"/>
            <column name="VERSION" value="1"/>
            <column name="FK_MODULE" value="1"/>
        </insert>
    </changeSet>

    <!-- Insert Role Module Rights -->
    <changeSet id="20150213#5" author="security-bootstrap" failOnError="true">
        <insert tableName="T_ROLE_MODULE_RIGHTS">
            <column name="fk_role" value="2"/>
            <column name="fk_module_right" value="1"/>
        </insert>
        <insert tableName="T_ROLE_MODULE_RIGHTS">
            <column name="fk_role" value="2"/>
            <column name="fk_module_right" value="2"/>
        </insert>
        <insert tableName="T_ROLE_MODULE_RIGHTS">
            <column name="fk_role" value="2"/>
            <column name="fk_module_right" value="3"/>
        </insert>
        <insert tableName="T_ROLE_MODULE_RIGHTS">
            <column name="fk_role" value="2"/>
            <column name="fk_module_right" value="4"/>
        </insert>
        <insert tableName="T_ROLE_MODULE_RIGHTS">
            <column name="fk_role" value="2"/>
            <column name="fk_module_right" value="5"/>
        </insert>
    </changeSet>

    <!-- Insert Account Module Rights -->
    <changeSet id="20150213#6" author="security-bootstrap" failOnError="true">
        <insert tableName="T_ACCOUNT_MODULE_RIGHTS">
            <column name="fk_account" value="2"/>
            <column name="fk_module_right" value="1"/>
        </insert>
    </changeSet>

</databaseChangeLog>
